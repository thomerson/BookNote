## 服务注册与发现

是指使用一个**注册中心**来记录分布式系统中的全部服务的信息，以便其他服务能够快速的找到这些已注册的服务。

注：注册中心如果宕机，不影响已注册服务器和客户端的APP业务。简单来说，注册中心最大程度上起到的是一个联系的作用，并不对服务器和客户端之间的具体交互做任何的干扰

解决了微服务架构最关键的问题：如何精准的定位需要调用的服务ip以及端口

### 功能

* Register
    服务启动时候进行注册

* Query
    查询已注册服务信息

* Healthy Check
    确认服务状态是否健康

### 角色

* provider 

    服务提供者

* consumer
    
    服务消费者

* register center

    注册中心


## 注册模式

* 自注册模式 

上述这些动作，有服务(client)本身来维护。每个服务启动后，需要到统一的服务注册中心进行注册登记，服务正常终止后，也可以到注册中心移除自身的注册记录。在服务执行过程中，通过不断的发送心跳信息，来通知注册中心，本服务运行正常。注册中心只要超过一定的时间没有收到心跳消息，就可以将这个服务状态判断为异常，进而移除该服务的注册记录。

* 三方注册模式 

这个模式与自注册模式相比，区别就是健康检查的动作不是有服务本身(client)来负责，而是由其它第三方服务来确认。有时候服务自身发送心跳信息的方式并不精确，因为可能服务本身已经存在故障，某些接口功能不可用，但仍然可以不断的发送心跳信息，导致注册中心没有发觉该服务已经异常，从而源源不断的将流量打到已经异常的服务上来。

## 发现模式

* 服务提供者```provider```

服务启动时将服务信息注册到注册中心，服务退出时将注册中心的服务信息删除掉。

* 服务消费者```consumer```

从服务注册表获取服务提供者的最新网络位置等服务信息，维护与服务提供者之间的通信。

* 注册中心```register cneter```

服务提供者和服务消费者之间的一个桥梁

### 客户端发现模式

在客户端模式下，如果要进行微服务调用，首先要进行的是到服务注册中心获取服务列表，然后再根据调用端本地的负载均衡策略，进行服务调用。

部分服务发现的实现都采取了客户端模式


### 服务端发现模式

客户端模式与服务端模式，两者的本质区别在于，**客户端是否保存服务列表信息**。

在服务端模式下，调用方直接向服务注册中心进行请求，服务注册中心再通过自身负载均衡策略，对微服务进行调用。这个模式下，调用方不需要在自身节点维护服务发现逻辑以及服务注册信息。

现代容器化部署平台（如Docker和Kubernetes）就是服务端服务发现模式



## 优点

* 服务器热插拔

* 服务器在线升级

* 容错机制

在客户端向服务器发送请求的过程中，该服务器突然宕机，就立刻切换到另一个服务器继续请求，不会影响请求的正常发送，是所谓的“容错”。

* 负载均衡

注册中心可以记录所有服务器的状态（服务器收到的请求次数，做出的响应次数，以及响应速度等等），以便给客户端推荐最合适的服务器



## 服务注册和发现的解决方案

* [Consul]()

* ZooKeeper

* etcd

* Eureka



