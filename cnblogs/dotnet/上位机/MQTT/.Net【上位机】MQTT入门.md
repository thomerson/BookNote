## MQTT


```Message Queuing Telemetry Transport```/消息队列遥测传输协议


一种基于**发布/订阅**（```publish/subscribe```）模式的“**轻量级**”通讯协议，该协议构建于TCP/IP协议上


最大优点在于，用极少的代码和有限的带宽，为连接远程设备提供实时可靠的消息服务

**低开销、低带宽占用的即时通讯协议**

使其在物联网、小型设备、移动应用等方面有较广泛的应用

![发布和订阅](https://pic4.zhimg.com/80/v2-8c518394020ae1ae8a14a8caf85d56fb_720w.webp)


### 主题

消息在允许过滤的主题下发布。主题是分层划分的 UTF-8 字符串。不同的主题级别用斜杠/作为分隔符号


### QoS

1. QoS 0

这一级别会发生消息丢失或重复，消息发布依赖于底层TCP/IP网络。即：<=1

![Qos0](https://pic3.zhimg.com/80/v2-dba21bbc002168f2e53ae469cd30c79a_720w.webp)

2. QoS 1

 承诺消息将至少传送一次给订阅者

3. QoS 2

保证消息仅传送到目的地一次。为此，带有唯一消息 ID 的消息会存储两次，首先来自发送者，然后是接收者。QoS 级别 2 在网络中具有最高的开销，因为在发送方和接收方之间需要两个流。

### MQTT 数据包结构

1. 固定头（```Fixed header```）

存在于所有MQTT数据包中，表示数据包类型及数据包的分组类标识；


2. 可变头（```Variable header```）

存在于部分MQTT数据包中，数据包类型决定了可变头是否存在及其具体内容；


3. 消息体（```Payload```）

存在于部分MQTT数据包中，表示客户端收到的具体内容

![数据包结构](https://pic3.zhimg.com/80/v2-861c089bea9570876bb13a031e6c3902_720w.webp)


## Mqtt Broker中间件

1. EMQ

2. Mosquitto


### 开源技术方案

1. MQTTnet

2. MqttDotNet

3. nMQTT

4. M2MQTT

### MQ教程

* [MQTT 教程](https://www.emqx.com/zh/mqtt-guide)

