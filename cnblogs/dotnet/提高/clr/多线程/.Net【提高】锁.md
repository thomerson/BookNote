## 概念


* 并行（parallel）：同一时间，多个线程/进程同时执行。多线程的目的就是为了并行，充分利用cpu多个核心，提高程序性能

* 线程（threading）：线程是操作系统能够进行 运算调度的最小单位，是进程的实际运作单位。
一条线程指的是进程中一个单一顺序的控制流，一个进程中可以并行多个线程，每条线程并行执行不同的任务。

* 进程（process）：进程是操作系统进行资源分配的基本单位。多个进程并行的在计算机上执行，多个线程并行的在进程中执行，
进程之间是隔离的，线程之间共享堆，私有栈空间。

CLR 为每个线程分配各自独立的 栈（stack） 空间，因此局部变量是线程独立的。

* 线程安全（thread safety）

* 排它锁/互斥锁/exclusive lock 

* 临界区（critical section）：在同一时刻只有一个线程能进入，不允许并发。当有线程进入临界区段时，其他试图进入的线程或是进程必须 等待或阻塞（blocking）

* 线程阻塞（blocking）：指一个线程在执行过程中暂停，以等待某个条件的触发来解除暂停。阻塞状态的线程不会消耗CPU资源

* 挂起（Suspend）：和阻塞非常相似，在虚拟内存管理的操作系统中，通常会把阻塞状态的进程的物理内存空间换出到硬盘，等需要再次运行的时候，再从硬盘换入到物理内存。描述进程没有占用实际的物理内存空间的情况，这个状态就是挂起状态。

* 线程调度器（thread scheduler）

* 中断（Interrupt）

* 中止（Abort）

## 锁



* 用户模式锁

    由特殊CPU指令来协调线程

    非阻塞线程同步

    * ```volatile```易变构造

        取消release对底层的优化，在读写的时候都从内存中读取

    * ```SpinLock```/旋转锁/自旋锁

    * ```MemoryBarrier```/内存屏障

* 内核模式锁

    是由**Windows系统**本身使用，内核对象进行调度协助的。内核对象是系统地址空间中的一个内存块，由系统创建维护。

    通常**不建议随便使用内核模式锁，资源付出相对较大**

    * ```AutoResetEvent```和```ManualResetEvent```事件锁

        手动事件和自动事件锁相比，差距在于可以对多个变量进行批量锁

    * ```Semaphore```信号量

        通过int数值来控制线程的个数

    * ```Mutex```互斥锁

        **进程间同步**

        可用于非全局变量互斥的情况，如同一ID的用户只允许提交一次抽奖请求

    以上三种锁都有```WaitOne()```方法，因为他们都继承自```waitHandle```

    * ```ReaderWriterLock```读写锁

* ```CountdownEvent```动态计数锁

    限制线程数的一个机制，同属于信号量的一种


* 监视锁/Monitor/lock

    属于**混合锁**，结合了**自旋锁**和**互斥锁**。刚开始会像自旋锁一样，先重试一定的次数；超过这个次数之后将线程设置为等待状态



### 使用上的不同

* 自旋锁

    指当一个线程在获取锁对象的时候，如果锁已经被其它线程获取，那么这个线程将会**循环等待，不断的去获取锁，直到获取到了锁**。适合于原子操作时间非常短的场景

    * 优点：避免了线程上下文切换。性能较高。

    * 缺点：如果长时间等待，将消耗大量的CPU资源。而且多个等待中的线程，并不是等待时间越长就先获取到锁，可能会一直等待下去。