## 索引

* 聚集索引

    存放的物理顺序和列中的顺序一样

    一般设置主键索引就为聚集索引


* 非聚集索引


### 聚集索引

一个没加主键的表，它的数据无序的放置在磁盘存储器上，一行一行的排列的很整齐。如果给表上了主键，那么表在磁盘上的存储结构就由整齐排列的结构转变成了树状结构，也就是**平衡树**结构，换句话说，就是整个表就变成了一个索引，也就是所谓的聚集索引。 这就是为什么一个表只能有一个主键， 一个表只能有一个聚集索引，因为主键的作用就是把表的数据格式转换成索引（平衡树）的格式放置。

![聚集索引](https://pic2.zhimg.com/80/v2-11ad4e1d08351fed1bff6a9232c0b261_720w.webp)

### 非聚集索引

非聚集索引和聚集索引一样， 同样是采用**平衡树**作为索引的数据结构。索引树结构中各节点的值来自于表中的索引字段， 假如给user表的name字段加上索引 ， 那么索引就是由name字段中的值构成，在数据改变时， DBMS需要一直维护索引结构的正确性。如果给表中多个字段加上索引 ， 那么就会出现多个独立的索引结构，每个索引（非聚集索引）互相之间不存在关联

![非聚集索引](https://pic4.zhimg.com/80/v2-9c21eca4e9f4e776e472523ace8379ab_720w.webp)

每次给字段建一个新索引， 字段中的数据就会被复制一份出来， 用于生成索引。 因此， 给表添加索引，会增加表的体积， 占用磁盘存储空间。

### 聚集和非聚集区别

* 通过聚集索引可以一次查到需要查找的数据， 而通过非聚集索引第一次只能查到记录对应的主键值 ， 再使用主键的值通过聚集索引查找到需要的数据。

* 聚集索引一张表只能有一个，而非聚集索引一张表可以有多个

### 设计索引规则

* 如果数据重复度高（超过10%），就不需要创建索引，例如性别

## 索引失效

1. ```is null```/```is not null```不会导致索引失效


2. ```@parma is null or param = @param``` 是否会导致索引失效


<!-- https://blog.51cto.com/u_15338523/3593593 -->


### 导致索引失效的几种写法及对应的解决方案

* != <> 全局扫描
* like 全文检索
* where 条件中有or，改用union
* in not in 会导致弃用索引的情况 ，改用exists ，连续数值考虑用between and，
* is null/is not null 不会导致弃用索引导致全表扫描
* 禁止在where 子句中的“=”左边进行函数、算术运算或其他表达式运算 例如select id from t where num/2=100

### 约束

一个表的索引数超过6个：索引固然可 以提高相应的 select 的效率，但同时也降低了 insert 及 update 的效率